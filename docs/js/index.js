(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()({1:[function(require,module,exports){
module.exports=function(){var CanvasHandler,CanvasHandlerPromise,GOLMap,aliveColour,c,compileCodeToConditioner,condNormal,deadColour,escape,golUtils,handleCanvas,makeSomeStuff,map,repaintCanvas,step,t,val,waitForFinalEvent;return aliveColour=[[31,141,214,1],[233,50,45,1],[97,204,79,1],[139,160,30,1],[160,91,30,1],[30,160,155,1]],deadColour=[66,66,66,.1],waitForFinalEvent=function(){var timers;return timers={},function(callback,ms,uniqueId){return uniqueId||(uniqueId="Don't call this twice without a uniqueId"),timers[uniqueId]&&clearTimeout(timers[uniqueId]),timers[uniqueId]=setTimeout(callback,ms)}}(),Array.prototype.unique=function(){var a,i,j,m,n,ref,ref1,ref2;for(a=this.concat(),i=m=0,ref=a.length-1;ref>=m;i=m+=1)for(j=n=ref1=i+1,ref2=a.length-1;ref2>=n;j=n+=1)a[i]===a[j]&&a.splice(j--,1);return a},escape=function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},CanvasHandlerPromise=function(){function CanvasHandlerPromise(root,parent,bodyFn){this.root=root,this.bodyFn=bodyFn}return CanvasHandlerPromise.prototype.bodyFn=null,CanvasHandlerPromise.prototype.next=null,CanvasHandlerPromise.prototype.root=null,CanvasHandlerPromise.prototype.flush=function(){return this.root.canvasHandler.flush()},CanvasHandlerPromise.prototype.call=function(label){var tgt;return tgt=this.root.promiseLabels[label],null!=tgt?this.next=tgt:this},CanvasHandlerPromise.prototype.label=function(label){return this.root.promiseLabels[label]=this},CanvasHandlerPromise.prototype.workOn=function(label){var tgt;return tgt=this.root.promiseLabels[label],null!=tgt?tgt:this},CanvasHandlerPromise.prototype.on=function(obj,event){var capturedCanvas;return capturedCanvas=null,this.next=new CanvasHandlerPromise(this.root,this,function(c){return capturedCanvas=c}),$(obj).on(event,function(_this){return function(){return waitForFinalEvent(function(){if(null!=capturedCanvas)return capturedCanvas.update(),_this.next.execute(capturedCanvas)},500,"CHPromiseWindowResize")}}(this)),this.next},CanvasHandlerPromise.prototype.paint=function(fn){return this.next=new CanvasHandlerPromise(this.root,this,fn)},CanvasHandlerPromise.prototype.execute=function(c){var ref,ref1,ref2;return null==c&&(c=null!=(ref=this.root)&&null!=(ref1=ref.canvasHandler)?ref1.canvas:void 0),null!=this.bodyFn&&(null!=this.bodyFn.paint?this.bodyFn.paint(c):this.bodyFn(c)),null!=(ref2=this.next)?ref2.execute(c):void 0},CanvasHandlerPromise}(),CanvasHandler=function(){function CanvasHandler(props1){this.props=props1,this.paintQueue=new CanvasHandlerPromise({canvasHandler:this,promiseLabels:[]},null,function(){}),$(document).ready(function(_this){return function(){return _this.updateCanvas(),_this.flush()}}(this))}return CanvasHandler.prototype.canvas=null,CanvasHandler.prototype.paintQueue=null,CanvasHandler.prototype.props=null,CanvasHandler.prototype.flush=function(){return this.canvas.update(),this.paintQueue.execute(this.canvas)},CanvasHandler.prototype.ready=function(){return this.paintQueue},CanvasHandler.prototype.updateCanvas=function(){var c,ctx,props;return c=$(this.props.id),ctx=c[0].getContext("2d"),props=this.props,this.canvas={x:ctx,dom:c,w:0,h:0,update:function(){return this.w=props.w(),this.h=props.h(),this.x.canvas.width=this.w,this.x.canvas.height=this.h}},this.canvas.update()},CanvasHandler}(),handleCanvas=function(props){var h;return h=new CanvasHandler(props),window.canvasHandler=h,h.ready()},repaintCanvas=function(){return window.canvasHandler.flush()},GOLMap=function(){function GOLMap(w,h1,conditioner1){var f_x,f_y,fi,fi_lower_l,fi_lower_rl,fi_upper_l,fi_upper_rl,m,map_c_x,map_c_y,map_maxd,n,ref,ref1,x,y;for(this.w=w,this.h=h1,this.conditioner=conditioner1,this.map=this.initMatrix(),this.mapBuffer=this.initMatrix(),this.alphaMask=this.initMatrix(),map_c_x=this.w/2,map_c_y=this.h/2,f_x=1,f_y=3,fi_lower_l=0,fi_upper_l=1,fi_upper_rl=.9,fi_lower_rl=0,map_maxd=.7*Math.sqrt(f_x*map_c_x*map_c_x+f_y*map_c_y*map_c_y+.1),x=m=0,ref=this.w;ref>=m;x=m+=1)for(y=n=0,ref1=this.h;ref1>=n;y=n+=1)fi=1-Math.sqrt(f_x*(x-map_c_x)*(x-map_c_x)+f_y*(y-map_c_y)*(y-map_c_y))/map_maxd,fi>fi_upper_rl&&(fi=fi_upper_l),fi_lower_rl>fi&&(fi=fi_lower_l),fi=Math.max(fi_lower_l,fi),fi=Math.min(fi_upper_l,fi),this.alphaMask[x][y]=fi}return GOLMap.prototype.map=null,GOLMap.prototype.mapBuffer=null,GOLMap.prototype.alphaMask=null,GOLMap.prototype.w=0,GOLMap.prototype.h=0,GOLMap.prototype.conditioner=null,GOLMap.prototype.initMatrix=function(){var m,n,ref,ref1,v,x,y;for(v=[],x=m=0,ref=this.w;ref>=m;x=m+=1)for(v.push([]),y=n=0,ref1=this.h;ref1>=n;y=n+=1)v[x].push(0);return v},GOLMap.prototype.set=function(x,y,name){if(null!=this.map[x]&&null!=this.map[x][y])return this.map[x][y]=this.conditioner.translateStateName(name)},GOLMap.prototype.drawStructure=function(x,y,obj){var k,results,v;results=[];for(k in obj)v=obj[k],k=k.split(","),results.push(this.set(parseInt(k[0])+x,parseInt(k[1])+y,v));return results},GOLMap.prototype.step=function(movx,movy){var m,n,o,ref,ref1,ref2,ref3,results,x,y;for(null==movx&&(movx=0),null==movy&&(movy=0),x=m=0,ref=this.w;ref>=m;x=m+=1)for(y=n=0,ref1=this.h;ref1>=n;y=n+=1)this.mapBuffer[x][y]=this.conditioner.step(x,y,this.map);for(results=[],x=o=ref2=movx,ref3=this.w-movx;ref3>=o;x=o+=1)results.push(function(){var q,ref4,ref5,results1;for(results1=[],y=q=ref4=movy,ref5=this.h-movy;ref5>=q;y=q+=1)results1.push(this.map[x][y]=this.mapBuffer[x+movx][y+movy]);return results1}.call(this));return results},GOLMap.prototype.paint=function(c){var field_h,field_margin_left,field_margin_top,field_rh,field_rw,field_w,m,ref,results,rgba,shift_x,shift_y,toth,totw,x,y,zoom;for(zoom=1.5,field_margin_left=2,field_margin_top=2,field_w=c.w*zoom/this.w,field_h=c.h*zoom/this.h,field_w=Math.min(field_w,field_h),field_h=field_w,totw=field_w*this.w,toth=field_h*this.h,shift_x=(c.w-totw)/2,shift_y=(c.h-toth)/2,field_rw=field_w-field_margin_left,field_rh=field_h-field_margin_top,results=[],x=m=0,ref=this.w;ref>=m;x=m+=1)results.push(function(){var n,ref1,results1;for(results1=[],y=n=0,ref1=this.h;ref1>=n;y=n+=1)c.x.save(),c.x.translate(x*field_w+shift_x,y*field_h+shift_y),rgba=this.conditioner.colour(this.map[x][y]),rgba[3]*=this.alphaMask[x][y],c.x.fillStyle="rgba("+rgba.join(",")+")",c.x.fillRect(-field_rw,-field_rh,field_rw,field_rh),results1.push(c.x.restore());return results1}.call(this));return results},GOLMap}(),golUtils={count:function(l){return l.length},rangeCircle:function(map,x0,y0,r){var m,n,ref,ref1,ref2,ref3,ret,x,y;for(ret=[],x=m=ref=x0-r,ref1=x0+r;ref1>=m;x=m+=1)for(y=n=ref2=y0-r,ref3=y0+r;ref3>=n;y=n+=1)(x-x0)*(x-x0)+(y-y0)*(y-y0)>r*r||null!=map[x]&&null!=map[x][y]&&ret.push(map[x][y]);return ret},rangeDistStraight:function(map,x0,y0,r){var m,n,ref,ref1,ref2,ref3,ret,x,y;for(ret=[],x=m=ref=x0-r,ref1=x0+r;ref1>=m;x=m+=1)for(y=n=ref2=y0-r,ref3=y0+r;ref3>=n;y=n+=1)(x-x0)*(x-x0)+(y-y0)*(y-y0)===r*r&&null!=map[x]&&null!=map[x][y]&&ret.push(map[x][y]);return ret},rangeDist:function(map,x0,y0,r){var d,m,n,ref,ref1,ref2,ref3,ret,x,y;for(ret=[],x=m=ref=x0-r,ref1=x0+r;ref1>=m;x=m+=1)for(y=n=ref2=y0-r,ref3=y0+r;ref3>=n;y=n+=1)d=(x-x0)*(x-x0)+(y-y0)*(y-y0),d>=r*r&&(r+1)*(r+1)>d&&null!=map[x]&&null!=map[x][y]&&ret.push(map[x][y]);return ret},filter:function(l,p){return l.filter(p)}},compileCodeToConditioner=function(code){var A,B,C,alias,code_without_decl,conditioner,defaultDecl,defaultStateDecl,dir,dir1,dir2,fn,i,len,len1,len2,len3,len4,len5,m,match,matchDecl,matchStatesDecl,n,ncode,noelse,o,prfdecl,prfdecl_decls,q,revcode,spl,statesNames,statesNamesAliases,sufdecl,u,varDecls,w;if(revcode=code.split("\n").reverse().join("\n"),ncode="",defaultDecl=null,defaultStateDecl=/^([ a-zA-Z0-9\[\]]+?)$/gm,match=defaultStateDecl.exec(revcode),null!==match&&(defaultDecl=match[0],code+="\n"+defaultDecl+": true\n"),match=defaultStateDecl.exec(revcode),null!==match)throw Error("Multiple default value declarations.");for(matchDecl=/^([ a-zA-Z0-9\<\-\>,\[\]]+?)(:(.*))?$/gm,match=matchDecl.exec(code),varDecls="";null!==match;)match[1].indexOf("set ")!==-1?(spl=match[1].split(" ")[1],varDecls+="var "+spl+" = "+match[3]+";\n"):ncode+=null==match[3]?match[1]+": true\n":""===match[3].trim()?match[1]+": true\n":match[1]+": "+match[3]+"\n",match=matchDecl.exec(code);for(matchStatesDecl=/^([ a-zA-Z0-9\<\-\>,\[\]]+?)(:(.*))$/gm,code=ncode,statesNames=[],statesNamesAliases={},match=matchStatesDecl.exec(code);null!==match;)statesNames=statesNames.concat(match[1].split(/->|,/g)).unique(),match=matchStatesDecl.exec(code);if(statesNames=statesNames.sort(function(a,b){return a.length===b.length?b-a:b.length-a.length}),null!==defaultDecl)for(statesNamesAliases[defaultDecl]=0,i=1,m=0,len=statesNames.length;len>m;m++)alias=statesNames[m],alias!==defaultDecl&&(statesNamesAliases[alias]=i,++i);else for(i=0,n=0,len1=statesNames.length;len1>n;n++)alias=statesNames[n],statesNamesAliases[alias]=i,++i;for(match=matchStatesDecl.exec(code),ncode="";null!==match;){if(dir=match[1].split("->"),C=match[3].trim(),2===dir.length)for(dir1=dir[0].split(","),dir2=dir[1].split(","),o=0,len2=dir1.length;len2>o;o++)for(A=dir1[o],q=0,len3=dir2.length;len3>q;q++)B=dir2[q],ncode+=B+": is("+A+") && ("+C+")\n";else for(dir1=dir[0].split(","),u=0,len4=dir1.length;len4>u;u++)A=dir1[u],ncode+=A+": "+C+"\n";match=matchStatesDecl.exec(code)}for(code=ncode,match=matchStatesDecl.exec(code),ncode="",noelse=!0;null!==match;)B=match[3].trim(),A=match[1].trim(),noelse||(ncode+="else "),ncode+="if("+B+") {return ("+A+");}\n",match=matchStatesDecl.exec(code),noelse=!1;for(code=ncode,sufdecl="return self;",prfdecl="",w=0,len5=statesNames.length;len5>w;w++)alias=statesNames[w],prfdecl+="var "+alias+" = "+statesNamesAliases[alias]+";\n";return prfdecl_decls="var self = map[x][y];\nvar get = function(x0, y0) {\n  if(map[x0] === undefined) {\n    return null;\n  }\n  if(map[x0][y0] === undefined) {\n    return null;\n  }\n  return map[x0][y0];\n};\nvar filterValue = function(t, v) { return t.filter(function(e){return e === v;}); };\nvar circle = function(r) { return golUtils.rangeCircle(map,x,y,r); };\nvar countCircleValues = function(r, v) { return (filterValue(circle(r),v)).length; };\nvar range = function(r) { return golUtils.rangeDist(map,x,y,r); };\nvar countRangeValues = function(r, v) { return (filterValue(range(r),v)).length; };\nvar rangeStraight = function(r) { return golUtils.rangeDistStraight(map,x,y,r); };\nvar countRangeStraightValues = function(r, v) { return (filterValue(rangeStraight(r),v)).length; };\nvar is = function(o, value) {\n  if(value === undefined) {\n    return map[x][y] === o;\n  }\n  return o === value;\n};\nvar $ = function(xr, yr) { return map[xr+x][yr+y]; };",code_without_decl=prfdecl+"\n"+varDecls+code+sufdecl,code=prfdecl+prfdecl_decls+"\n"+varDecls+code+sufdecl,conditioner={colour:function(v){return v%=this.states,[aliveColour[v%aliveColour.length][0],aliveColour[v%aliveColour.length][1],aliveColour[v%aliveColour.length][2],aliveColour[v%aliveColour.length][3]]}},conditioner.translateStateName=function(name){return null==statesNamesAliases[name]?0:statesNamesAliases[name]},conditioner.states=statesNames.length,code="(function(x, y, map){\n"+code+"})",window.onUpdateCompiledCode(code_without_decl),fn=eval(code),conditioner.step=fn,conditioner},condNormal=compileCodeToConditioner("set k: countRangeValues(1, Live)\nLive->Dead: k<2\nLive->Dead: k>3\nLive->Live: k == 2 || k == 3\nDead->Live: k == 3\nDead"),val="Live",map=new GOLMap(80,50,condNormal),c=handleCanvas({id:"#golcanvas",w:function(){return $(window).width()},h:function(){return $(window).height()}}),makeSomeStuff=function(strength){var box_x_rng,box_y_rng,i,j,m,num,prb,ref,results,x0,y0;for(box_x_rng=[0,80],box_y_rng=[0,80],prb=50*Math.random()+50,results=[],j=m=0,ref=prb;ref>=m;j=m+=1)num=Math.random()*strength+10,results.push(function(){var n,ref1,results1;for(results1=[],i=n=0,ref1=num;ref1>=n;i=n+=1)Math.random()>.5?(x0=Math.random()*(box_x_rng[1]-box_x_rng[0])+box_x_rng[0],y0=Math.random()*(box_y_rng[1]-box_y_rng[0])+box_y_rng[0],x0=parseInt(x0),y0=parseInt(y0),results1.push(map.set(x0,y0,val))):results1.push(void 0);return results1}());return results},t=101,makeSomeStuff(10),step=function(){var s;return t>10&&(makeSomeStuff(10),t=0),s=0,map.step(s,s),c.flush(),++t},window.step=function(){return step()},setInterval(function(){return step()},500),c.on(window,"resize").paint(function(c){return c.x.fillStyle="rgba(0, 45, 66, 0.1)",c.x.fillRect(0,0,c.w,c.height)}).paint(map),window.golMap=map,window.golCompileCode=function(code){return map.conditioner=compileCodeToConditioner(code)}}();

},{}],2:[function(require,module,exports){
!function(){var codeInput,codeOutput,compileCode;return codeInput=null,codeOutput=null,window.onUpdateCompiledCode=function(code){if(null!=codeOutput)return codeOutput.update(code)},require("./gol.coffee"),compileCode=function(){var code,el;el=$("#code-wrapper"),code=el.text(),window.golCompileCode(code)},$(document).ready(function(){var el,tim;return codeInput=new CodeFlask,codeInput.run("#code-wrapper",{language:"javascript"}),codeInput.update("Live: Math.random() > 0.99\nLive->Live2: Math.random()>0.99\nLive->Live: true\nLive2->Live2: true\nDead"),codeOutput=new CodeFlask,window.codeOutput=codeOutput,codeOutput.run("#code-wrapper-out",{language:"javascript"}),el=$("#code-wrapper"),tim=-1,el.on("keydown keyup changed",function(){return clearTimeout(tim),tim=setTimeout(function(){return compileCode()},250)}),compileCode()})}();

},{"./gol.coffee":1}]},{},[2]);
